---
layout: post
status: publish
published: true
title: Writing An Appender For log4net
author:
  display_name: Rob Prouse
  login: admin
  email: rob@prouse.org
  url: http://www.alteridem.net
author_login: admin
author_email: rob@prouse.org
author_url: http://www.alteridem.net
wordpress_id: 37
wordpress_url: http://www.alteridem.net/2008/01/10/writing-an-appender-for-log4net/
date: '2008-01-10 09:38:58 +0000'
date_gmt: '2008-01-10 14:38:58 +0000'
categories:
- C#
- log4net
tags: []
comments:
- id: 2128
  author: Gabriel
  author_email: vbbrasil@gmail.com
  author_url: ''
  date: '2008-07-10 11:48:55 +0000'
  date_gmt: '2008-07-10 16:48:55 +0000'
  content: Thank you very much!
- id: 8172
  author: Logging SQL Statements generated by NHibernate &laquo; devioblog
  author_email: ''
  author_url: http://devio.wordpress.com/2010/04/14/logging-sql-statements-generated-by-nhibernate/
  date: '2010-04-14 10:34:06 +0000'
  date_gmt: '2010-04-14 15:34:06 +0000'
  content: "[...] and where I saved every SQL statement to a separate file. To accomplish
    this, one would need to implement their own log4net appender, I [...]"
- id: 8786
  author: yossharel
  author_email: yossharel@walla.com
  author_url: ''
  date: '2010-07-21 08:51:10 +0000'
  date_gmt: '2010-07-21 13:51:10 +0000'
  content: It's very helpful to me. I didn't think it's so easy to do. I used this
    as I wrote appender to Wcf. Thank you!
- id: 8795
  author: Rambhopal Reddy E
  author_email: me.rambhopal@gmail.com
  author_url: http://mydotnetinfo.blogspot.com
  date: '2010-07-23 04:00:01 +0000'
  date_gmt: '2010-07-23 09:00:01 +0000'
  content: "it is usefull article.\r\n\r\nbut how to use that in windows forms..\r\n\r\nlogger.error(\"\");\r\n\r\nit
    is not displaying the messagebox.\r\n\r\ncan you please how to call in form1.cs"
- id: 8798
  author: Rob Prouse
  author_email: rob@prouse.org
  author_url: http://www.prouse.org
  date: '2010-07-23 08:26:33 +0000'
  date_gmt: '2010-07-23 13:26:33 +0000'
  content: "Rambhopal,\r\n\r\nI expect that you either haven't set up logging in your
    application, or your configuration is incorrect.\r\n\r\n1. If you change your
    configuration to log to a file, does that work? If not, then you need to set up
    logging in your application. You either have to add an XmlConfigurator attribute
    to your assembly, or call XmlConfigurator.ConfigureAndWatch( ConfigFile ); See
    the log4net docs on getting started, or my presentation example code at http://www.alteridem.net/2008/02/29/log4net-slides-and-example-code/\r\n\r\n2.
    If logging to file is working, then you probably have it configured wrong. Make
    sure the first part of type in the appender tag matches your appender name and
    make sure the second part matches the DLL or EXE name that the appender is in.
    Check this line;\r\n\r\n\r\n\r\nLet me know if you have problems.\r\n\r\nRob"
- id: 13960
  author: Krishna
  author_email: kvramire@gmail.com
  author_url: ''
  date: '2011-07-01 10:16:06 +0000'
  date_gmt: '2011-07-01 14:16:06 +0000'
  content: I am lucky to find this webpage. i implemented this custom appender successfully
    with this article. thank you very much for this good and complete inforamtion
- id: 19585
  author: kev
  author_email: lettier.kevin@laposte.net
  author_url: ''
  date: '2012-03-08 07:40:25 +0000'
  date_gmt: '2012-03-08 11:40:25 +0000'
  content: "hi ! thank you for this useful code :)\r\nI would like to know if you
    have a trick to retrieve the DialogResult in my app after the call of Append method
    ?\r\n\r\nThanks !"
- id: 19588
  author: Rob Prouse
  author_email: rob@prouse.org
  author_url: http://www.alteridem.net
  date: '2012-03-08 10:24:18 +0000'
  date_gmt: '2012-03-08 14:24:18 +0000'
  content: "The only thing that I can think of that would be thread safe is to put
    the result in thread local storage in the appender and then retrieve it in your
    code after the logging call. You will need to make sure you handle if it is not
    found in thread local storage because the logging configuration may change. Also,
    if you have a lot of logging, it could be problematic to handle it everywhere.\r\n\r\nYou
    might also be able to throw a specific exception in the appender and catch it
    in your code.\r\n\r\nPersonally, both of these solutions feel wrong to me."
---
<p>In <a href="http://logging.apache.org/">log4net</a> speak, an appender is an output destination for a log such as a file, the console, a database or even email.&nbsp; <a href="http://logging.apache.org/">log4net</a> ships with so many appenders that most of us will never need to write our own.&nbsp; There are cases where you may find a need for your own appender, for example, you may want to log errors to your company's bug tracking software.&nbsp; </p>
<p>In our case, we simply wanted error logs to pop up a message box with the error and location.&nbsp; We run this internally so that developers run into errors immediately during development and can break into the debugger to fix them.&nbsp; We found that logging to a file was too easy to ignore.</p>
<p><img height="232" alt="MessageBoxAppender" src="/images/2008/01/messageboxappender.jpg" width="484" border="0"> </p>
<p>I was pleasantly surprised how easy it is to write a new appender, but there is very little information on the web, so I thought it would be best to give an example.</p>
<ol>
<li>Create a new Class Library project in Visual Studio.
<li>Add a reference to log4net. My appender also uses MessageBox, so I also added references to System.Drawing and System.Windows.Forms.
<li>Remove the default Class1.cs added to the project.
<li>Add your appender class. In my case, MessageBoxAppender.cs.
<li>You could implement the <a href="http://logging.apache.org/log4net/release/sdk/log4net.Appender.IAppender.html">log4net.Appender.IAppender</a> interface, but it is easiest to derive from <a href="http://logging.apache.org/log4net/release/sdk/log4net.Appender.AppenderSkeleton.html">log4net.Appender.AppenderSkeleton</a>, then most of the work is done for you.
<li>At a minimum, override the <a href="http://logging.apache.org/log4net/release/sdk/log4net.Appender.AppenderSkeleton.Append_overload_2.html">Append</a> method. This is where you do your work.
<li>If you are going to use the <a href="http://logging.apache.org/log4net/release/sdk/log4net.Appender.AppenderSkeleton.RenderLoggingEvent_overload_1.html">RenderLoggingEvent</a> method to create your logging message based on the configured layout (such as PatternLayout), override the <a href="http://logging.apache.org/log4net/release/sdk/log4net.Appender.AppenderSkeleton.RequiresLayout.html">RequiresLayout</a> property and return true.
<li>When you configure your appender, you must give the assembly qualified name for your appender.&nbsp; For example,</li>
</ol>
<p><appender name="..." type="MyNamespace.MyAppender, MyAssembly"></p>
<p>Here is the simplified code for the MessageBoxAppender that I wrote.</p>
<pre><code>using System;
using System.Windows.Forms;
using System.Diagnostics;

using log4net.Core;
using log4net.Appender;

namespace Alteridem.log4net
{
    /// <summary>
    /// Displays a MessageBox for all log messages.
    /// </summary>
    public class MessageBoxAppender : AppenderSkeleton
    {
        /// <summary>
        /// Writes the logging event to a MessageBox
        /// </summary>
        override protected void Append( LoggingEvent loggingEvent )
        {
            string title = string.Format( "{0} {1}",
                loggingEvent.Level.DisplayName,
                loggingEvent.LoggerName );

            string message = string.Format(
                "{0}{1}{1}{2}{1}{1}(Yes to continue, No to debug)",
                RenderLoggingEvent( loggingEvent ),
                Environment.NewLine,
                loggingEvent.LocationInformation.FullInfo );

            DialogResult result = MessageBox.Show( message, title, MessageBoxButtons.YesNo );

            if ( result == DialogResult.No )
            {
                Debugger.Break();
            }
        }

        /// <summary>
        /// This appender requires a <see cref="Layout"/> to be set.
        /// </summary>
        override protected bool RequiresLayout
        {
            get { return true; }
        }
    }
}</code></pre>
<p>There isn't much to see here. I use the log level and the log name in the titlebar. I display the rendered message string and the calling location in the MessageBox and I break into the debugger if you press No.</p>
<p>Now, to configure this for your developers to see ERROR messages, the following configuration would work.</p>
<pre><code><?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <section name="log4net"
        type="log4net.Config.Log4NetConfigurationSectionHandler, log4net" />
    </configSections>
    <log4net>
        <appender name="MessageBoxAppender"
            type="Alertidem.log4net.MessageBoxAppender, log4netExtensions">
            <layout type="log4net.Layout.PatternLayout">
                <ConversionPattern value="%m" />
            </layout>
        </appender>
        <root>
            <level value="ERROR"/>
            <appender-ref ref="MessageBoxAppender" />
        </root>
    </log4net>
</configuration></code></pre>
<p>The only thing to not here is that the log4netExtensions in the appender line is the assembly.</p>
<p>This should be enough to give you a basic framework to build whatever type of appender you want.&nbsp; Every time I delve into a new area of <a href="http://logging.apache.org/log4net/">log4net</a>, I am once again surprised how easy it is to work with and how well designed it is.&nbsp; If you aren't using it, I would highly recommend it.</p>
